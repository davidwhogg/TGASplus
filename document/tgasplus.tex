% This file is part of the TGASplus project.
% Copyright 2016 the authors.

% ## Style notes
% - Use n-dash (--) for color--magnitude diagram.

% ## To-do
% - Draft method section
% - Get and write up results
% - Put in all figures
% - Draft discussion
% - Find all HOGG, XXX, DWH, CITE, and fix these
% - What does ``stationary'' mean?

\documentclass[12pt]{article}
\usepackage{url}

% text definitions
\include{gitstuff}
\newcommand{\documentname}{\textsl{Paper}}
\newcommand{\project}[1]{\textsl{#1}}
\newcommand{\acronym}[1]{\small{#1}}
\newcommand{\gaia}{\project{Gaia}}
\newcommand{\tgas}{\project{\acronym{TGAS}}}
\newcommand{\twomass}{\project{\acronym{2MASS}}}
\newcommand{\wise}{\project{All\acronym{WISE}}}
\newcommand{\wone}{W\!\mathit{1}}

% math definitions
\newcommand{\given}{\,|\,}
\newcommand{\normal}{\mathcal{N}}
\newcommand{\setof}[1]{\{{#1}\}}
\newcommand{\pc}{\mathrm{pc}}

% typographic style stuff
\setlength{\textheight}{9in}
\setlength{\topmargin}{-0in}
\setlength{\headheight}{0ex}
\setlength{\headsep}{0ex}
\setlength{\oddsidemargin}{\topmargin}
\urlstyle{sf}
\linespread{1.08}
\frenchspacing
\sloppy\sloppypar\raggedbottom

\begin{document}

\section*{Far, far better distances for Gaia stars}

\noindent
DWH, DSTN, others?

\paragraph{Abstract:}
% Context:
Given that the color--magnitude diagram of stars is highly informative, the
best measure of a \gaia\ \tgas\ Catalog star's distance will not be based on
its tabulated parallax measurement alone (or even at all):
The star's color and magnitude are both very informative too.
Furthermore, because of statistical shrinkage, the colors, magnitudes,
and parallaxes of all the \emph{other} stars in the Catalog are \emph{also}
informative.
% Aims:
Here we make use of both of these pieces of information---but no
physical models of stars whatsoever---to greatly improve our distance
estimates for \gaia\ \tgas\ stars.

% Methods:
For each object star in \tgas, we find the $K=128$ most nearby \tgas\ stars
in a \gaia--\twomass--\wise\ color--color space.
We build a noise-deconvolved model of the \gaia\ $G$-band absolute
magnitude distribution of these same-color stars, properly accounting
for the parallax uncertainties.
This model is a mixture of Gaussians in absolute magnitude, and the
mixture parameters are set by optimizing a marginalized likelihood,
which in turn is computed by post-processing a posterior sampling made
under an interim prior.
We use this noise-deconvolved model---which is very informative---to
build a prior on distance for the object star and generate posterior
beliefs about (and a posterior sampling of) its distance.
This method is a leave-one-out approximation to a hierarchical model for
a patch of the color--magnitude diagram.

% Results:
The posterior pdfs we generate for distance for typical \tgas\ stars
are more informative (more precise) by a factor of XXX relative to any
comparable analysis of the star's parallax measurement alone.
Everything we do here can be done, only far better, for subsequent
\gaia\ data releases.

\section{Introduction}

A parallax is a direct, geometric measurement of the distance to a star.
For this reason it is a beautiful piece of information: It can be used
to infer a stellar distance without resort to any physical or
theoretical beliefs about the evolution, dynamics, structure, or
photospheres of stars.
That's sick, and makes astronomers very confident about parallax-based
distance inferences and the science built thereon.

While we agree that it is very valuable to obtain as much information
as possible about stellar distances and the distance scale without
resort to (necessarily imperfect) stellar models, we disagree that the
best model-free estimate of a star's distance involves the parallax
alone.
Not only is the \emph{photometry} of the star---the color across
multiple bands---also relevant, the photometry and parallaxes of
\emph{all other stars} are \emph{also} highly relevant.
The idea is a simple consequence of the concept of \emph{statistical shrinkage}:
If stars are generated by a straightforward, stationary process---that
is, if for every star in the Galaxy there are many other very similar
stars---then the noisy parallaxes of all other stars with similar
photometric properties are highly relevant to the inverse parallax
(distance) of the star in question.

\begin{figure}[p]
~~
\caption{The color--magnitude diagram of stars in \tgas\ and matched
  to \twomass. We only show stars that have parallaxes measured at a
  signal-to-noise greater than 32. The distance modulus estimate is
  described (WHERE HOGG?) and the extinction corrections are described
  (WHERE HOGG?).\label{fig:cmd}}
\end{figure}

One way to see this is to naively plot the color-magnitude diagram of
stars in the \gaia\ \acronym{DR1} \tgas\ catalog of parallaxes and
photometry, after joining with \twomass\ or \wise\ to get colors.
The resulting diagram is shown for some signal-to-noise cuts in
\figurename~\ref{fig:cmd}.
This color--magnitude diagram is incredibly informative, and was built
without the use of any knowledge of stellar physics or any stellar models at all.
To ignore this photometric information is obviously a mistake, especially for
stars with very noisy parallax measurements.
Of course \figurename~\ref{fig:cmd} was built with improper distance
inferences; the distances used to make that color-magnitude diagram
are just point estimates of distance given parallaxes.
We shouldn't use such point estimates when it is straightforward to
use the parallax likelihood functions responsibly to propagate the noisy
information they provide about distances (CITE CBJ).

In this \documentname, we use the parallax likelihood correctly, and also the
color--magnitude information about \emph{all} stars, to infer every
individual star's distance responsibly.
We don't go full Bayes at all levels of the hierarchy of our model,
but we are careful not to ``use the data twice''.
There are no conceptual roadblocks to doing a full hierarchical
probabilistic inference in the future.
Despite our shortcuts, we produce extremely informative and highly
predictive posterior pdfs for stellar distances.
Our distance estimates are far better than those made considering the
parallax alone (CITE CBJ), despite including absolutely no new
information about stellar physics or theory.

\section{Assumptions and method}

The \tgas\ Catalog (CITE) contains $N=XXX$ stars $n$, each of which has (for
our purposes) a magnitude $G_n$, a measured parallax $\varpi_n$, and
an uncertainty $\sigma_n$ on that parallax.
Each of these stars (with a few exceptions) can be matched to entries
in the \twomass\ Catalog (CITE) and the \wise\ Catalog (CITE), from
which we can get infrared $J$ and $\wone$ magnitudes.
We extinction-corrected the photometry by XXX YYY HOGG; we excluded
the XXX stars for which these corrections exceeded XXX\,mag.
We visualize the resulting data in \figurename~\ref{fig:data}.
%
\begin{figure}[p]
~~
\caption{The data used in this project.\label{fig:data}}
\end{figure}

In what follows, we make a set of well-defined assumptions, build and
execute a method that is justified under those assumptions, and then
(at the end) criticize the assumptions and the results that flow therefrom.
The assumptions are as follows:
\begin{enumerate}\itemsep=0ex
\item For typical stars taken from the \tgas\ Catalog, the parallax
  uncertainty is larger in an absolute-magnitude sense than the
  uncertainty in the $G$, $J$, $\wone$, or relevant dust extinction. That
  is, we can ignore photometric uncertainties relative to astrometric
  uncertainties.
\item For every object star $n$, there are $K$ nearby neighbors in
  $(G-J, G-\wone)$ color space that are both sufficiently close that they
  are drawn from the same absolute magnitude distribution as star $n$,
  but sufficiently numerous that they can support a model for their
  distribution.
\item We have an interim prior on stellar distances for \tgas\ stars
  that has support at all reasonable distances, and we have a
  $T$-sample sampling of distance $d$ for every star under that
  interim prior.
\end{enumerate}

We bat around the following equations:
\begin{eqnarray}
  d_{kt} &\sim& p(d\given\varpi_k,\theta_0)
  \\
  p(d\given\theta_0) &=& \frac{1}{Z}\,d^2\,\exp(-\frac{d^2}{L^2})
  \\
  p(M_G\given\alpha_n) &=& \sum_{q=1}^Q a_q\,\normal(M_G\given\mu_q,V_q)
  \\
  \alpha_n &=& \setof{a_q, \mu_q, V_q}_{q=1}^Q
  \\
  1 &=& \sum_{q=1}^Q a_q
  \\
  p(d\given\alpha_n) &\propto& \frac{1}{d}\,p(M_G\given\alpha_n)
  \\
  M_G &\equiv& G - A_G - 5\,\log_{10}(\frac{d}{10\,\pc})
  \\
  p(\alpha_n\given\varpi_k) &\propto& \frac{1}{T}\,\sum_{t=1}^T \frac{p(d_{kt}\given\alpha_n)}{p(d_{kt}\given\theta_0)}
  \\
  \ln p(\alpha_n\given\Pi_n) &=& \sum_{k=1}^K p(\alpha_n\given\varpi_k)
  \\
  \Pi_n &\equiv& \setof{\varpi_k}_{k=1}^K
\end{eqnarray}

\section{Results and discussion}
We ran on everything and got XXX.

Here are some plots comparing to CBJ-style inferences.

HOGG: How much better when we get BpRp and RVS!

All the data used in this project are public. All the code used in
this project is open-source. The main codebase is licensed under the
\project{\acronym{MIT} License} and available at
\url{https://github.com/davidwhogg/TGASplus}. This version of the
manuscript and figures was made at git hash
\textsf{\githash\,(\gitdate)}.

\paragraph{Acknowledgements:}
It is a pleasure to thank
  Jo Bovy (Toronto),
  and
  Dan Foreman-Mackey (UW)
for valuable advice and discussions.
We are funded by (HOGG: various agencies).

\end{document}
